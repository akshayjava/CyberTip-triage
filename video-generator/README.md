# CyberTip Triage — Demo Video Generator

Fully automated 90-second product demo video using Claude (script), ElevenLabs/OpenAI TTS (voiceover), Playwright (screen recording), and FFmpeg (assembly).

## Prerequisites

```bash
# ffmpeg must be in PATH
brew install ffmpeg          # macOS
sudo apt install ffmpeg      # Ubuntu / Debian
choco install ffmpeg         # Windows

# Node.js 20+
node --version

# Install dependencies (from this directory)
cd video-generator
npm install
npx playwright install chromium
```

## Environment variables

Create a `.env` file in `video-generator/`:

```env
# Required — script generation
ANTHROPIC_API_KEY=sk-ant-...

# Required — app must be running
APP_URL=http://localhost:3000

# Pick one TTS provider:
TTS_PROVIDER=openai
OPENAI_API_KEY=sk-...

# OR
TTS_PROVIDER=elevenlabs
ELEVENLABS_API_KEY=...
ELEVENLABS_VOICE_ID=21m00Tcm4TlvDq8ikWAM   # Rachel (default)

# OR (silent video, good for testing)
TTS_PROVIDER=none

# Optional
KEEP_INTERMEDIATES=false     # Set true to keep intermediate files for debugging
VERBOSE=true                 # Print full cue list in summary
FFMPEG_PATH=/usr/local/bin/ffmpeg   # If ffmpeg not in PATH
```

## Usage

```bash
# Start the main app first (in another terminal)
cd ..
npm run dev

# Full pipeline — runs all stages
npm run generate

# Skip seeding (if demo data already in app)
npm run generate -- --skip-seed

# Regenerate only the final assembly (reuse existing recording + audio)
npm run generate -- --assemble-only

# Generate script only (review before recording)
npm run generate -- --script-only

# Record only (uses latest.json script, skips TTS)
npm run generate -- --skip-voice --record-only
```

## Output

```
output/
  demo.mp4            ← Share this
  voiceover.mp3       ← TTS audio
  recording.webm      ← Raw Playwright capture
  captions.srt        ← Subtitles
  manifest.json       ← Generation metadata

scripts/
  latest.json         ← Most recent script
  script_<ts>.json    ← Timestamped archives
```

## Pipeline stages

| Stage | Tool | Time | Cost |
|-------|------|------|------|
| Script generation | Claude Opus | ~30s | ~$0.05 |
| Voiceover (OpenAI TTS) | OpenAI | ~20s | ~$0.02 |
| Voiceover (ElevenLabs) | ElevenLabs | ~15s | ~$0.02 |
| Screen recording | Playwright | ~100s | free |
| Assembly | FFmpeg | ~30s | free |
| **Total** | | **~3 min** | **~$0.07** |

## Customising the script

The script is generated by Claude from a detailed system prompt in `src/script.ts`. To change what the demo focuses on, edit the `SCRIPT_SYSTEM_PROMPT` in that file — specifically the `PRODUCT FEATURES TO COVER` section.

To use a hand-written script instead of generating one, create `scripts/latest.json` matching the `DemoScript` type in `src/types.ts` and run with `--skip-script`.

## Troubleshooting

**"ffmpeg not found"** — Install ffmpeg and ensure it's in PATH, or set `FFMPEG_PATH`.

**Playwright actions fail** — The CSS selectors in `src/record.ts` match the dashboard HTML. If selectors break after a UI update, edit `cue.action.target` values in the generated script JSON.

**Timing drift** — If audio and video are out of sync, regenerate without `--skip-script`. The script controls both audio and video timing.

**App not reachable** — Ensure the main app is running (`npm run dev` from project root) and `APP_URL` matches.

**Silent video** — Set `TTS_PROVIDER=none` to intentionally skip audio for a screen-recording-only output.
